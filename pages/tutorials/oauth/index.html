<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../favicon.png">

    <title>Using OAuth - DeskPRO React SDK</title>

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/agate.min.css">
    <link rel="stylesheet" href="../../../css/base.css">
    <link rel="stylesheet" href="../../../css/psinder.css">
    
    


    <link href="../../../css/site.css" rel="stylesheet">


    <link href="../../../css/admonition.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="//oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">
                <img src="../../../logo.png" />
                DeskPRO React SDK
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Overview</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../manifest/">Manifest</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../props/">Props</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../components/DeskproSDK/">DeskproSDK</a>
</li>

                        
                            
<li >
    <a href="../../components/Routes/">Routes</a>
</li>

                        
                            
<li >
    <a href="../../components/Link/">Link</a>
</li>

                        
                            
<li >
    <a href="../../components/LinkButton/">LinkButton</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../basic/">Basic App</a>
</li>

                        
                            
<li >
    <a href="../form/">Form Handling</a>
</li>

                        
                            
<li class="active">
    <a href="./">Using OAuth</a>
</li>

                        
                            
<li >
    <a href="../redux/">Using Redux</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li>
                        <a href="https://github.com/DeskproApps/sdk-react">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#overview">Overview</a></li>
        
            <li class="second-level"><a href="#oauth-review">OAuth review</a></li>
            
                <li class="third-level"><a href="#settings">Settings</a></li>
            
                <li class="third-level"><a href="#registration">Registration</a></li>
            
                <li class="third-level"><a href="#credentials">Credentials</a></li>
            
                <li class="third-level"><a href="#authorization">Authorization</a></li>
            
                <li class="third-level"><a href="#success">Success</a></li>
            
        
            <li class="second-level"><a href="#step-1-clone-the-boilerplate">Step 1. Clone the boilerplate</a></li>
            
        
            <li class="second-level"><a href="#step-2-configure-the-manifest">Step 2. Configure the manifest</a></li>
            
        
            <li class="second-level"><a href="#step-3-create-a-settings-page">Step 3. Create a settings page</a></li>
            
        
            <li class="second-level"><a href="#step-4-create-an-index-page">Step 4. Create an index page</a></li>
            
        
            <li class="second-level"><a href="#step-5-modify-the-app-component">Step 5. Modify the app component</a></li>
            
        
            <li class="second-level"><a href="#step-6-run-the-dev-server">Step 6. Run the dev server</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="overview">Overview</h1>
<p>This tutorial will walk you through creating a DeskPRO app which uses oauth to authenticate with a remote service provider. This tutorial will use <a href="https://github.com/">GitHub</a> as an example.</p>
<h3 id="oauth-review">OAuth review</h3>
<p>Before starting the tutorial let's go over designing DeskPRO apps to use the oauth work flow.</p>
<h4 id="settings">Settings</h4>
<p>DeskPRO admins must configure the app for oauth on the first run. Configuration is handled by showing the admin a form which has a "Authorization callback URL" value and inputs to enter a client ID and client secret.
<img alt="screenshot" src="../../../images/tutorials/oauth-1.png" /></p>
<h4 id="registration">Registration</h4>
<p>The admin is instructed to visit their <a href="https://github.com/settings/developers">GitHub account settings</a> in order to register the app. The admin will provide the "Authorization callback URL" to the registration form.
<img alt="screenshot" src="../../../images/tutorials/oauth-5.png" /></p>
<h4 id="credentials">Credentials</h4>
<p>On the next page the admin will be given a client ID and client secret.
<img alt="screenshot" src="../../../images/tutorials/oauth-6.png" /></p>
<p>The admin comes back to the app settings form where they enter and save the client ID and client secret. This concludes configuring the app for oauth, and the admin may close the window.
<img alt="screenshot" src="../../../images/tutorials/oauth-7.png" /></p>
<h4 id="authorization">Authorization</h4>
<p>Now when an agent opens the app they will be prompted to authenticate with GitHub.
<img alt="screenshot" src="../../../images/tutorials/oauth-4.png" /></p>
<h4 id="success">Success</h4>
<p>Upon successful authentication the agent will be shown the index page.
<img alt="screenshot" src="../../../images/tutorials/oauth-2.png" /></p>
<hr />
<p>To follow this tutorial you will need:</p>
<ul>
<li>A <a href="https://github.com/">GitHub</a> account</li>
<li><a href="https://github.com/deskpro/deskpro/blob/develop/README.md">DeskPRO running on your computer</a></li>
<li>NPM 6 or greater</li>
<li>Git 1.9 or greater</li>
<li>A IDE or text editor</li>
</ul>
<hr />
<h3 id="step-1-clone-the-boilerplate">Step 1. Clone the boilerplate</h3>
<p>The SDK boilerplate includes the basic app configuration and files to help developers get started writing apps.</p>
<pre><code>git clone https://github.com/deskpro/deskproapps-boilerplate-react oauth-tutorial
cd oauth-tutorial
npm install
</code></pre>

<h3 id="step-2-configure-the-manifest">Step 2. Configure the manifest</h3>
<p>Edit the app configuration in <em>package.json</em>, which can be found in the app root directory. Change the "title" property to "OAuth Tutorial". Also add the "storage" values shown below.</p>
<pre><code class="json">&quot;deskpro&quot;: {
  &quot;version&quot;: &quot;2.1.0&quot;,
  &quot;title&quot;: &quot;OAuth Tutorial&quot;,
  &quot;isSingle&quot;: true,
  &quot;scope&quot;: &quot;agent&quot;,
  &quot;storage&quot;: [
    {
      &quot;name&quot;: &quot;oauth:github&quot;,
      &quot;isBackendOnly&quot;: true,
      &quot;permRead&quot;: &quot;EVERYBODY&quot;,
      &quot;permWrite&quot;: &quot;OWNER&quot;
    },
    {
      &quot;name&quot;: &quot;settings&quot;,
      &quot;isBackendOnly&quot;: false,
      &quot;permRead&quot;: &quot;EVERYBODY&quot;,
      &quot;permWrite&quot;: &quot;OWNER&quot;
    },
    {
      &quot;name&quot;: &quot;user_settings&quot;,
      &quot;isBackendOnly&quot;: false,
      &quot;permRead&quot;: &quot;OWNER&quot;,
      &quot;permWrite&quot;: &quot;OWNER&quot;
    }
  ]
}
</code></pre>

<p><strong>Explanation</strong><br />
@todo</p>
<h3 id="step-3-create-a-settings-page">Step 3. Create a settings page</h3>
<p>Create a new component with a form at <em>src/main/javascript/PageSettings.jsx</em>.</p>
<pre><code class="jsx">// PageSettings.jsx

import React from 'react';
import { sdkConnect } from 'deskpro-sdk-react';
import { Form, Input, Button } from 'deskpro-components/lib/bindings/redux-form';

class PageSettings extends React.PureComponent {
  /**
   * Called when the form is submitted
   */
  handleSubmit = (settings) =&gt; {
    const { oauth, route } = this.props;

    // Create a &quot;connection&quot; object using the submitted values, plus
    // the values for urlAccessToken and urlAuthorize. Then register
    // the connection with the oauth module and redirect to the
    // index page.
    const connection = Object.assign({}, settings, {
      urlAccessToken: 'https://github.com/login/oauth/access_token',
      urlAuthorize:   'https://github.com/login/oauth/authorize'
    });
    oauth.register('github', connection);
    route.to('index');
  };

  /**
   * @returns {XML}
   */
  render() {
    const { oauth, storage } = this.props;

    return (
      &lt;Form
        name=&quot;settings&quot;
        initialValues={storage.app.settings}
        onSubmit={storage.onSubmitApp(this.handleSubmit)}
        &gt;
        &lt;p&gt;
          You must register this app with GitHub before using it.
          Fill out the app registration form and when you come to
          the &quot;Authorization callback URL&quot; field enter the following
          value:
        &lt;/p&gt;
        &lt;code&gt;
          {oauth.providers.github.urlRedirect}
        &lt;/code&gt;
        &lt;Input
          label=&quot;Client ID&quot;
          id=&quot;clientId&quot;
          name=&quot;clientId&quot;
        /&gt;
        &lt;Input
          label=&quot;Client Secret&quot;
          id=&quot;clientSecret&quot;
          name=&quot;clientSecret&quot;
        /&gt;
        &lt;Button&gt;
          Save
        &lt;/Button&gt;
      &lt;/Form&gt;
    );
  }
}

export default sdkConnect(PageSettings);
</code></pre>

<p><img alt="screenshot" src="../../../images/tutorials/oauth-1.png" /></p>
<p><strong>Explanation</strong><br />
@todo</p>
<h3 id="step-4-create-an-index-page">Step 4. Create an index page</h3>
<p>Create a new component to display the oauth access token at <em>src/main/javascript/PageIndex.jsx</em>.</p>
<pre><code class="jsx">// PageIndex.jsx

import React from 'react';
import { sdkConnect } from 'deskpro-sdk-react';

class PageIndex extends React.Component {
  /**
   * @returns {XML}
   */
  render() {
    const { storage } = this.props;

    return (
      &lt;div&gt;
        &lt;p&gt;
          {storage.app.user_settings ? (
            &lt;p&gt;
              Thanks for authenticating!
              Your access token is:
              {storage.app.user_settings.accessToken}
            &lt;/p&gt;
          ) : (
            &lt;p&gt;
              Oop! Looks like authentication failed!
            &lt;/p&gt;
          )}
        &lt;/p&gt;
      &lt;/div&gt;
    );
  }
}

export default sdkConnect(PageIndex);
</code></pre>

<p><img alt="screenshot" src="../../../images/tutorials/oauth-2.png" />
<img alt="screenshot" src="../../../images/tutorials/oauth-3.png" /></p>
<p><strong>Explanation</strong><br />
@todo</p>
<h3 id="step-5-modify-the-app-component">Step 5. Modify the app component</h3>
<p>Edit the app component at <em>src/main/javascript/App.jsx</em> to look like the following code.</p>
<pre><code class="jsx">// App.jsx

import React from 'react';
import PageSettings from './PageSettings';
import PageIndex from './PageIndex';

export default class App extends React.Component {
  /**
   * Invoked immediately after a component is mounted
   */
  componentDidMount() {
    const { oauth, storage, route, ui } = this.props;

    // The app settings will be empty the first time the app is run.
    // Route to the settings page so the admin can setup oauth creds.
    if (!storage.app.settings) {
      return route.to('settings');
    }

    // Route to the index page if the user already has an access token.
    if (storage.app.user_settings.accessToken) {
      return route.to('index');
    }

    // Otherwise obtain the access token using oauth.
    oauth.access('github')
      // Save the access token and redirect to the index page.
      .then((resp) =&gt; {
        const user_settings = {
            accessToken: resp.accessToken
        };
        storage.setApp({ user_settings });
        return route.to('index');
      })
      // Send any errors directly to the UI to be displayed.
      .catch(ui.error);
  }

  /**
   * @returns {XML}
   */
  render() {
    return (
      &lt;Routes&gt;
        &lt;Route location=&quot;settings&quot; component={PageSettings} /&gt;
        &lt;Route location=&quot;index&quot; component={PageIndex} /&gt;
      &lt;/Routes&gt;
    );
  }
}
</code></pre>

<p><img alt="screenshot" src="../../../images/tutorials/oauth-4.png" /></p>
<p><strong>Explanation</strong><br />
@todo</p>
<h3 id="step-6-run-the-dev-server">Step 6. Run the dev server</h3>
<p>Make sure DeskPRO is running on your computer, and then from the app root directory run the following command.</p>
<pre><code>npm run dev
</code></pre>

<p>The <code>dev</code> script builds your app and starts a development server which communicates with DeskPRO to install the app. Open <a href="https://deskpro-dev/agent/?appstore.environment=development">https://localhost/agent/?appstore.environment=development</a> when the the <code>dev</code> command finishes building to view the finished app.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        
            
            <p><a href="https://github.com/DeskproApps/sdk-react/tree/master/docs/pages/tutorials/oauth.md" class="icon icon-github"> Edit this page on GitHub</a></p>
            
        
        
            <small>Copyright 2001 – 2017 Deskpro Ltd. All rights reserved.<br></small>
        
    </footer>

    <script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
            </div>
        </div>
    </div>
    </body>
</html>
